{% extends 'web/layout.html' %}

{% block content %}

<div class="card mb-3">
    <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs navbar-expand-lg" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Assignment</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Tests</a>
            </li>
            {% if submit %}
            <li class="nav-item">
                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Source code</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-{% if submit.points and submit.points == submit.max_points %}success{%else%}danger{%endif%}" id="contact-tab" data-toggle="tab" href="#result" role="tab" aria-controls="contact" aria-selected="false">
                    Result #{{ submit.submit_num }} 
                    {%if submit.max_points %}({{ submit.points }} / {{ submit.max_points }}){%else%}evaluating...{%endif%}
                </a>
            </li>

            {% if debug %}
            <li class="nav-item">
                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#debug-json">Raw JSON</a>
            </li>
            {% endif %}

            {% endif %}

            <li class="nav-item ml-auto">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <form method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            <input type="file" name="{{ upload_form.solution.html_name }}" hidden id="upload-choose" onchange="form.submit()">
                            <span class="btn btn-sm btn-primary" onclick="$('#upload-choose').click()">Upload</span>
                        </form>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                {{ text|safe }}
            </div>
            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                {% for input in inputs %}
                <h2>{{ input.title }}</h2>

                <code>$ ./main {{ input.escaped_args }}</code>
    
                {% if input.stdin %}
                <div class="card mb-3">
                    <div class="card-header">
                        <h5>stdin</h5>
                    </div>
                    <div class="card-body">
                        <pre>{{ input.stdin.read }}</pre>
                    </div>
                </div>
                {% endif %}

                {% if input.stdout %}
                <div class="card mb-3">
                    <div class="card-header">
                        <h5>stdout</h5>
                    </div>
                    <div class="card-body">
                        <pre>{{ input.stdout.read }}</pre>
                    </div>
                </div>
                {% endif %}

                {% if input.stderr %}
                <div class="card mb-3">
                    <div class="card-header">
                        <h5>stderr</h5>
                    </div>
                    <div class="card-body">
                        <pre>{{ input.stderr.read }}</pre>
                    </div>
                </div>
                {% endif %}

                {% for file in input.files %}
                <div class="card mb-3">
                    <div class="card-header">
                        <h5>{{ file.path }}</h5>
                    </div>
                    <div class="card-body">
                        <pre>{{ file.expected.read }}</pre>
                    </div>
                </div>
                {% endfor %}

                {% endfor %}
            </div>

            <div class="tab-pane fade" id="contact">
                    {{ source|safe }}
            </div>

            <div class="tab-pane fade" id="result">
                {% include "web/report.html" %}
            </div>

            {% if debug %}
            <div class="tab-pane fade" id="debug-json">
                <pre>{{ submit.result }}</pre>
            </div>
            {% endif %}
        </div>
    </div>
</div>   


<div class="card mb-3 mt-2">
    <div class="card-header">
        <h5>Submit</h5>
    </div>
    <div class="card-body">
        <code>
            $ upr submit {{ task.code }} my_file.c
        </code>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ upload_form.solution }}
            <input type="submit" class="btn btn-primary" value="Upload">
        </form>
    </div>
</div>

{% endblock %}