{% if submit %}
<div class="card mb-3">
    <div class="card-header text-{% if submit.points and submit.points == submit.max_points %}success{%else%}danger{%endif%}">
        <h5>Submit #{{ submit.submit_num }} {%if submit.max_points %}({{ submit.points }} / {{ submit.max_points }}){%else%}evaluating...{%endif%} </h5>
    </div>
    <div class="card-body">
        {{ source|safe }}
    </div>
</div>



{% for result in results %}
<div class="card mb-3">
    <div class="card-header">
        <h5>{{ result.name }}</h5>
    </div>
    <div class="card-body">
        <code>$ {{ result.gcc.command }}</code>
        <pre>{{ result.gcc.stderr }}</pre>
    </div>

    {% for test in result.tests %}
    <div class="card mb-3 mx-3 {% if test.success%}border-success{%else%}border-danger{%endif%}">
        <div class="card-header {% if test.success%}bg-success{%else%}bg-danger{%endif%}">
            <h5>
                {{ test.name }}
                <div class="float-right">
                    {{ test.time }}s, {{ test.maxrss|filesizeformat }}
                </div>
            </h5>
            
        </div>
        <div class="card-body">
<pre style="color: #e83e8c">
$ {{ test.command }}{% if test.message %}
{{ test.message }}{%endif%}
$ echo $?  # exit code (return value from main)
{{ test.exit_code }}
</pre>

            {% if test.stdin %}
            <div class="card mb-3">
                <div class="card-header">
                    stdin
                </div>
                <div class="card-body">
                    <pre>{{ test.stdin }}</pre>
                </div>
            </div>
            {% endif %}

            {% if test.stdout %}
            <div class="card mb-3">
                <div class="card-header">
                    stdout
                </div>
                <div class="card-body diff">
                    <pre class="actual">{{ test.stdout }}</pre>
                    <pre class="expected">{{ test.stdout_expected }}</pre>
                </div>
            </div>
            {% endif %}

            {% if test.stderr %}
            <div class="card mb-3">
                <div class="card-header">
                    stderr
                </div>
                <div class="card-body diff">
                    <pre class="actual">{{ test.stderr }}</pre>
                    <pre class="expected">{{ test.stderr_expected }}</pre>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}

</div>
{% endfor %}

{% if debug %}
<div class="card mb-3">
    <div class="card-header">
        <h5>Raw output</h5>
    </div>
    <div class="card-body">
        <pre>{{ submit.result }}</pre>
    </div>
</div>
{% endif %}

{% endif %}

<script>
document.querySelectorAll('.diff').forEach(function(elem) {
    let actual = elem.querySelector('.actual').textContent;
    let expected = elem.querySelector('.expected').textContent;
    let fragment = document.createDocumentFragment();

    Diff.diffWords(actual, expected).forEach(function(part) {
        let color = part.added ? 'green' : part.removed ? 'red' : 'black';
        let span = document.createElement('pre');
        span.style.display = 'inline'
        span.style.color = color;
        span.appendChild(document.createTextNode(part.value));
        fragment.appendChild(span);
    });

    elem.querySelector('.actual').style.display = 'none';
    elem.querySelector('.expected').style.display = 'none';
    elem.appendChild(fragment);
});
</script>